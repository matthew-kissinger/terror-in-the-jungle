{
  "session_id": "827c393ed07e",
  "task_id": "cf7c0a6d-ad46-423a-9585-6d0c0c07accc",
  "agent": "claude",
  "model": "sonnet",
  "repo_path": "/home/mkagent/repos/terror-in-the-jungle",
  "timestamp": "2026-01-24T22:40:19.199886",
  "layers": [
    {
      "name": "prompt",
      "content": "# Task: Implement Shotgun Weapon\n\n## Context\nThe game currently has rifles/SMGs but lacks a close-range option. The GDD explicitly requests a shotgun for jungle close-quarters combat. This is listed as Priority 6 in CLAUDE.md under \"NEW WEAPON: Shotgun\".\n\n## Requirements (from GDD)\n- Spread pattern (8-12 pellets)\n- High damage at close range, weak at distance\n- Pump action with satisfying animation\n- Distinct audio profile\n- Good for jungle close-quarters\n\n## Discovery - Read These Files First\n1. src/systems/player/FirstPersonWeapon.ts - Current weapon implementation\n2. src/systems/player/InventoryManager.ts - Weapon hotbar system\n3. src/systems/player/ProgrammaticGunFactory.ts - How gun meshes are created\n4. src/systems/audio/AudioManager.ts - How weapon sounds work\n5. src/types/Weapon.ts or similar - Weapon type definitions\n\n## Implementation Steps\n1. Define shotgun weapon stats in the weapon config:\n   - baseDamage: 15 per pellet\n   - pelletCount: 10\n   - spreadAngle: 8 degrees (cone)\n   - maxDamageRange: 5m (full damage)\n   - falloffRange: 15m (min damage)\n   - fireRate: 60 RPM (pump action)\n   - magazineSize: 6\n   - reloadTime: 2.5s\n\n2. Add spread firing logic to FirstPersonWeapon:\n   - For each pellet, calculate spread offset\n   - Cast separate ray for each pellet\n   - Each pellet does independent damage with distance falloff\n\n3. Create procedural shotgun mesh in ProgrammaticGunFactory:\n   - Wider barrel\n   - Pump action grip visible\n   - Shorter overall length\n\n4. Add shotgun to inventory system (slot 3 or 4)\n\n5. Add distinct audio:\n   - Loud boom (different frequency than rifle)\n   - Pump action sound on reload/between shots\n\n## Damage Calculation\n- Base damage: 15 per pellet\n- At 0-5m: 100% damage (150 if all hit)\n- At 5-15m: Linear falloff to 20%\n- At 15m+: 20% damage cap (30 if all hit)\n\n## Validation\n- Shotgun appears in weapon inventory (press 3 or 4)\n- Firing shoots 10 pellets in a spread\n- Close range kills NPCs quickly (1-2 shots)\n- Long range does minimal damage\n- Pump action delay between shots\n- Distinct audio plays\n\n## Completion\nWhen done: test in browser, commit with descriptive message (no emojis), provide summary.",
      "source": "task.prompt"
    },
    {
      "name": "output_format",
      "content": "Required output format: <task_result> block with commit, pr_url, branch, summary",
      "source": "generated"
    }
  ]
}