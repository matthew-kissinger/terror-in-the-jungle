{
  "session_id": "4432c0d3d411",
  "task_id": "19d4ed32-82e3-41c4-828c-24bb1a395d0a",
  "agent": "claude",
  "model": "sonnet",
  "repo_path": "/home/mkagent/repos/terror-in-the-jungle",
  "timestamp": "2026-01-24T22:03:55.990437",
  "layers": [
    {
      "name": "prompt",
      "content": "## Task: Enhance Explosion Effects\n\n### Context\nTerror in the Jungle is a 3D pixel art battlefield game. Per CLAUDE.md, explosion effects are weak and need more visual impact. The game has GrenadeSystem for grenades and recently reimplemented MortarSystem. Both need better explosion visuals.\n\n### Current State\n- GrenadeSystem.ts handles grenade throwing and detonation\n- MortarSystem.ts with MortarBallistics.ts handles mortar shells\n- ExplosionEffectsPool.ts (in src/systems/effects/) handles explosion rendering\n- ImpactEffectsPool.ts handles bullet impact effects\n- PostProcessingManager.ts has screen shake capability\n\n### Files to Read First\n1. src/systems/weapons/GrenadeSystem.ts - Find detonation code\n2. src/systems/effects/ExplosionEffectsPool.ts - Understand current explosion rendering\n3. src/systems/effects/PostProcessingManager.ts - Find camera shake methods\n4. src/systems/audio/AudioManager.ts - Explosion sounds\n\n### Implementation Goals\n\n1. **Visual Explosion Enhancement**:\n   - Larger initial flash (bright white/yellow)\n   - More particles in explosion cloud\n   - Debris/dirt particles flying outward\n   - Smoke that lingers after explosion (fades over 2-3 seconds)\n   - Ground scorching (optional - dark circle decal)\n\n2. **Screen Effects**:\n   - Camera shake that scales with distance (stronger when closer)\n   - Brief screen flash when explosion is nearby\n   - Possible brief blur effect for very close explosions\n\n3. **Audio Enhancement**:\n   - Louder, punchier explosion sound\n   - Distance-based attenuation\n   - Low frequency rumble component\n   - Echo/reverb for jungle environment\n\n### Implementation Steps\n\n1. **Read the existing code**:\n   - Read ExplosionEffectsPool.ts to understand current implementation\n   - Read GrenadeSystem.ts to see how explosions are triggered\n   - Check PostProcessingManager for camera shake\n\n2. **Enhance ExplosionEffectsPool.ts**:\n   - Increase particle count (if instanced, this is cheap)\n   - Add multiple particle layers: flash, fireball, smoke, debris\n   - Increase explosion duration (flash 100ms, fireball 300ms, smoke 2000ms)\n   - Add size scaling based on explosion type (grenade vs mortar)\n\n3. **Add camera shake on explosion**:\n   - In GrenadeSystem.ts detonation, call camera shake\n   - Calculate intensity based on distance to player\n   - Use exponential falloff: intensity = baseShake * exp(-distance/30)\n\n4. **Test explosions**:\n   - npm run dev\n   - Throw grenades (G key) near player\n   - Test from various distances\n   - Verify shake, particles, and audio work together\n\n### Technical Approach\n\nFor particles, consider using instanced rendering:\n- Flash sphere: bright yellow, scales up quickly, fades\n- Fireball: orange/red particles with upward drift\n- Smoke: gray particles, slow fade, slight upward drift\n- Debris: small dark particles, parabolic trajectory\n\n### Validation Criteria\n- Explosions should be visible from 100m away\n- Camera shake noticeable but not nauseating\n- Smoke lingers for 1-2 seconds after explosion\n- Audio is punchy and satisfying\n- No frame drops during multiple explosions\n\nWhen complete: test in browser with multiple grenades, commit with message like 'feat(effects): enhance explosion visuals with particles and camera shake', provide summary.",
      "source": "task.prompt"
    },
    {
      "name": "output_format",
      "content": "Required output format: <task_result> block with commit, pr_url, branch, summary",
      "source": "generated"
    }
  ]
}