{
  "session_id": "db71c2c2fd16",
  "task_id": "f70bae29-43a0-461d-9705-d36b67f7166c",
  "agent": "claude",
  "model": "haiku",
  "repo_path": "/home/mkagent/repos/terror-in-the-jungle",
  "timestamp": "2026-01-24T21:25:19.176466",
  "layers": [
    {
      "name": "prompt",
      "content": "## Context\nYou are working on Terror in the Jungle, a 3D pixel art battlefield game with Three.js. The grenade system exists but the throwing arc is unclear - players can't see where grenades will land before throwing.\n\n## Your Task\nAdd a visual trajectory preview when the player is holding a grenade (G key), showing the predicted arc and landing point.\n\n## Discovery Phase\nRead these files:\n1. `src/systems/weapons/GrenadeSystem.ts` - current grenade implementation (560 lines)\n2. `src/systems/player/PlayerController.ts` - handles G key for grenade throwing\n3. `src/ui/hud/HUDElements.ts` - grenade power meter UI\n\n## Requirements\n\n### Trajectory Preview\n1. When player holds G key and is charging throw power, show:\n   - Dashed arc line from player to predicted landing point\n   - Small circle/marker at predicted landing point\n2. Arc should update in real-time as:\n   - Player moves mouse (changes direction)\n   - Throw power increases (G held longer = farther throw)\n3. Use same physics as actual grenade trajectory\n\n### Visual Style\n1. Arc line: White or cyan dashed line, ~2px width\n2. Landing marker: Circle on ground, ~1m radius\n3. Both should be semi-transparent (0.5-0.7 alpha)\n4. Hide preview when grenade is released\n\n### Technical Implementation\n1. Create `GrenadeTrajectoryPreview.ts` module (~150 lines)\n2. Use THREE.Line with dashed material for arc\n3. Sample ~20 points along parabolic path\n4. Use ChunkManager.getHeightAt() to find ground intersection\n5. Integrate with GrenadeSystem\n\n## Physics Reference\nFrom GrenadeSystem.ts:\n- Initial velocity: throwPower * throwDirection\n- Gravity: 9.8 m/s^2 downward\n- Time step: simulate until y < terrain height\n\n## Implementation Steps\n1. Create GrenadeTrajectoryPreview class\n2. Add method to compute arc points given throw vector and power\n3. Add THREE.Line for arc visualization\n4. Add ground marker mesh\n5. Wire into GrenadeSystem - show when charging, hide on throw/cancel\n6. Update each frame while charging\n\n## Validation\n- Press G to charge grenade, see arc appear\n- Move mouse - arc direction changes\n- Hold G longer - arc extends farther\n- Release G - arc disappears, grenade follows shown path\n- Verify landing point matches actual grenade landing\n\n## Completion\nWhen complete:\n1. Build: `npm run build`\n2. Test in browser - throw several grenades, verify preview accuracy\n3. Commit: \"feat(weapons): add grenade trajectory preview arc\"\n4. Brief summary of implementation",
      "source": "task.prompt"
    },
    {
      "name": "output_format",
      "content": "Required output format: <task_result> block with commit, pr_url, branch, summary",
      "source": "generated"
    }
  ]
}