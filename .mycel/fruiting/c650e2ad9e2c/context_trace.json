{
  "session_id": "c650e2ad9e2c",
  "task_id": "d67d11f2-92c9-45c5-aee2-ec896ef8f400",
  "agent": "claude",
  "model": "sonnet",
  "repo_path": "/home/mkagent/repos/terror-in-the-jungle",
  "timestamp": "2026-01-24T19:11:21.783686",
  "layers": [
    {
      "name": "prompt",
      "content": "You are working on Terror in the Jungle, a 3D pixel art battlefield game with Three.js.\n\n## Context\nThe game currently has a rifle as the main weapon. The GDD calls for adding a shotgun as a close-range option for jungle combat. The weapon system uses a procedural gun factory and supports multiple weapons.\n\n## Task\nImplement a new shotgun weapon with spread pattern and close-range damage falloff.\n\n## Discovery\nRead these files first to understand the weapon system:\n1. src/systems/player/ProgrammaticGunFactory.ts - How weapons are created\n2. src/systems/weapons/GunplayCore.ts - Core shooting mechanics\n3. src/systems/player/FirstPersonWeapon.ts - If it exists, how weapons are rendered\n4. src/systems/player/InventoryManager.ts - Weapon switching\n5. src/systems/combat/CombatantHitDetection.ts - Hit detection system\n6. src/config/audio.ts - Audio configuration for weapons\n\n## Implementation Requirements\n\n### Shotgun Characteristics (from GDD):\n- 8-12 pellet spread pattern per shot\n- High damage at close range (< 10m), rapid falloff beyond\n- Pump action with ~0.8s cycle time\n- Magazine size: 6-8 shells\n- Distinct audio profile (bass-heavy boom)\n\n### Technical Implementation:\n1. Create shotgun weapon definition in ProgrammaticGunFactory or similar\n2. Implement pellet spread:\n   - Each pellet is a separate raycast\n   - Spread pattern: cone with ~8-12 degree angle\n   - Each pellet does partial damage (e.g., 15 damage per pellet)\n3. Damage falloff:\n   - Full damage: 0-8m\n   - 50% damage: 8-15m  \n   - 25% damage: 15-25m\n   - No damage beyond 25m\n4. Add weapon switching (key 2 or weapon wheel)\n5. Add pump animation timing (cant fire during pump cycle)\n6. Create shotgun audio (or use placeholder with appropriate config)\n\n### Integration:\n- Add to player loadout\n- Add key binding (likely \"2\" for secondary weapon)\n- Update HUD ammo display to work with shotgun\n\n## Validation\n1. Run npm run build - must compile without errors\n2. Run npm run dev and test in browser:\n   - Shotgun fires with visible spread\n   - Close range kills in 1-2 shots\n   - Long range does minimal damage\n   - Pump animation prevents rapid fire\n   - Ammo depletes and reloads work\n\n## Conventions\n- Keep modules under 400 lines\n- TypeScript strict mode\n- No semicolons\n- Test in browser before committing\n- Commit message: \"feat(weapons): add shotgun with pellet spread and damage falloff\"\n\nWhen complete: test in browser, commit with descriptive message, provide summary of implementation.",
      "source": "task.prompt"
    },
    {
      "name": "output_format",
      "content": "Required output format: <task_result> block with commit, pr_url, branch, summary",
      "source": "generated"
    }
  ]
}